\documentclass{book}

\usepackage{etoolbox}

\makeatletter
\def\subtitle#1{\gdef\@subtitle{#1}}
\patchcmd\maketitle
  {{\LARGE \@title \par}}
  {{\LARGE \@title \par}%
   \vskip 1.5em
   {\Large \@subtitle \par}}
\makeatother

\usepackage[utf8x]{inputenc}
\usepackage{amsmath,mathtools,bbm}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{graphicx}
\usepackage{listings}
\usepackage{appendix}
\usepackage{enumitem}
\usepackage{bm}
\usepackage{multicol}
\usepackage{geometry}
\usepackage{colortbl}
\usepackage{changepage}
\usepackage{color}
\usepackage{mathrsfs}
\usepackage{bigints}
\usepackage{pdflscape}
\usepackage{adjustbox}
\usepackage{tocloft}
\usepackage{lscape}
\usepackage[colorlinks=true,
            linkcolor=blue,
            urlcolor=blue,
            citecolor=blue]{hyperref}

\lstset{%
backgroundcolor=\color[gray]{.85},
basicstyle=\small\ttfamily,
breaklines = true,
keywordstyle=\color{red!75},
columns=fullflexible,
}%

\lstdefinelanguage{BibTeX}
  {keywords={%
      @article,@book,@collectedbook,@conference,@electronic,@ieeetranbstctl,%
      @inbook,@incollectedbook,@incollection,@injournal,@inproceedings,%
      @manual,@mastersthesis,@misc,@patent,@periodical,@phdthesis,@preamble,%
      @proceedings,@standard,@string,@techreport,@unpublished%
      },
  comment=[l][\itshape]{@comment},
  sensitive=false,
  }

\definecolor{codegreen}{rgb}{0,0.6,0}
\definecolor{codegray}{rgb}{0.5,0.5,0.5}
\definecolor{codepurple}{rgb}{0.58,0,0.82}
\definecolor{backcolour}{rgb}{0.97,0.97,0.97}
\definecolor{stringorange}{rgb}{0.95, 0.4, 0.18}

\lstdefinestyle{mystyle}{
    backgroundcolor=\color{backcolour},   
    commentstyle=\color{codegreen},
    keywordstyle=\color{codepurple},
    numberstyle=\tiny\color{codegray},
    stringstyle=\color{stringorange},
    basicstyle=\ttfamily\footnotesize,
    breakatwhitespace=false,         
    breaklines=true,                 
    captionpos=b,                    
    keepspaces=true,                 
    numbers=left,                    
    numbersep=5pt,                  
    showspaces=false,                
    showstringspaces=false,
    showtabs=false,                  
    tabsize=2
}
\lstset{style=mystyle}

\sloppy
\usepackage{tikz, lipsum}% http://ctan.org/pkg/{pgf,lipsum}
\newcommand*{\chapnumfont}{\normalfont\sffamily\huge\bfseries}
\newcommand*{\printchapternum}{
  \begin{tikzpicture}
    \draw[fill,color=gray75] (0,0) rectangle (2cm,2cm);
    \draw[color=white] (1cm,1cm) node { \chapnumfont\thechapter };
  \end{tikzpicture}
}
\newcommand*{\chaptitlefont}{\normalfont\sffamily\Huge\bfseries}
\newcommand*{\printchaptertitle}[1]{\flushright\chaptitlefont#1}

\makeatletter
% \@makechapterhead prints regular chapter heading.
% Taken directly from report.cls and modified.
\def\@makechapterhead#1{%
  \vspace*{50\p@}%
  {\parindent \z@ \raggedleft
    \ifnum \c@secnumdepth >\m@ne
        \printchapternum
        \par\nobreak
        \vskip 20\p@
    \fi
    \interlinepenalty\@M
    \printchaptertitle{#1}\par\nobreak
    \vskip 40\p@
  }}
% \@makeschapterhead prints starred chapter heading.
% Taken directly from report.cls and modified.
\def\@makeschapterhead#1{%
  \vspace*{50\p@}%
  {\parindent \z@ \raggedleft
    \interlinepenalty\@M
    \printchaptertitle{#1}\par\nobreak
    \vskip 40\p@
  }}
\makeatother

\makeatletter\@addtoreset{chapter}{part}\makeatother%

\renewcommand{\cfttoctitlefont}{\hfill\Huge\bfseries\sffamily}

\renewcommand\contentsname{Table of contents}

\definecolor{gray75}{gray}{0.75}

\title{\Huge \bfseries\sffamily Worlds Of Observation}
\subtitle{\Large \bfseries\sffamily \color{gray75} Building more realistic environments for machine learning}
\author{\bfseries\sffamily Robert J. Hardwick  \and C. M. Gomez-Perales}
\date{\today}

\begin{document}
\begin{titlepage}
\centering
\vspace*{1.5\baselineskip}
{\color{gray75}\rule{13cm}{1.3pt}}\vspace*{-\baselineskip}\vspace*{2pt} % Thick horizontal rule
{\color{gray75}\rule{13cm}{0.4pt}} \\ % Thin horizontal rule
\vspace{1.2\baselineskip} % Whitespace 
{\Huge \bfseries\sffamily Worlds Of Observation} \\ 
\vspace{4mm}
{\Large \bfseries\sffamily \color{gray75} Building more realistic environments\\ for machine learning \\}
\vspace*{0.75\baselineskip}
{\color{gray75}\rule{13cm}{0.4pt}}\vspace*{-\baselineskip}\vspace*{2.75pt} % Thick horizontal rule
{\color{gray75}\rule{13cm}{1.3pt}} \\ % Thin horizontal rule
\vspace{1.0\baselineskip} % Whitespace 
{\large \bfseries\sffamily Robert J. Hardwick and C. M. Gomez-Perales \\
\vspace*{1.2\baselineskip}}
\today
\vfill
Shared by the authors under an \href{https://opensource.org/licenses/MIT}{MIT License}.\\ \vspace{1mm}
The code to compile this book is open source and can be found in this repository: \url{https://github.com/umbralcalc/worlds-of-observation}.
\end{titlepage}

\chapter*{Introduction}

In many systems of practical importance to the real world it's common to find that observing the state of the system itself is only partially possible. One needs to only think of the measurement uncertainties in any scientific experiment, the latent demand behind orders in a financial market, the unknown reservoirs of infection for a disease pathogen or even the limits to complete supply chain component observability in recognising just how ubiquitous this situation is. This obscurity can make the learning of algorithms to control these systems using observations alone an extreme --- if not sometimes impossible --- challenge without further insight provided by a model.

\emph{Worlds Of Observation} is a book about building more realistic training environments for machine learning algorithms to control these `noisy' systems in the real world. While model-free reinforcement learning is a popular and very powerful approach to generating such algorithms~\cite{sutton2018reinforcement} (especially when there is plenty of data and the system is fully observable), this book will primarily explore how to create control algorithms using a more model-based approach. Those readers who are data scientists, research engineers, statistical programmers or computational scientists may find our mathematically descriptive, yet practically-minded, approach in this book quite interesting and maybe a little different to the usual perspectives.

As can be expected from a book about algorithms, this text accompanies a lot of new open-source scientific software written in various combinations of Go~\cite{golang}, C++~\cite{c++lang}, Python~\cite{pythonlang} and TypeScript~\cite{typescriptlang}. A major motivation for creating these new tools is to prepare a foundation of code from which to develop new and more complex applications. We also hope that the resulting framework will enable anyone to study new phenomena and explore complex control problems effectively, regardless of their scientific background.

The need to properly test all this software has also provided a wonderful excuse to study and play with an extensive range of models which simulate real-world systems. We've chosen these models based on a fairly broad background of interests, but also to illustrate the cross-disciplinary applicability of our algorithmic framework. To achieve this generalisation, an essential part of this book is the mathematical framework that it introduces and uses throughout. To explore these simulated systems further we encourage readers to take a look at WorldsOOp (\href{https://worldsoop.github.io/}{https://worldsoop.github.io/}), which is an open source software ecosystem inspired directly by this book.

It seems silly to us that mathematical formalities can obscure the practical computations that a programmer is being asked to implement when reading an equation. So, while we've tried to be as ambitious as possible with the level of technical detail in this book, we've also attempted to write many of the mathematical expressions in a more computer-friendly way where feasible,\footnote{For example, we'll typically be thinking more in terms of `matrices' and less about `operators'.} in contrast with the more conventional formal descriptions. To help with this goal of explainability, we also make use of quite a lot of illustrations and diagrams.

A quick note on the code: any software that we describe in this book (including the software which compiles the book itself~\cite{worldsofobservationbookgithub}) will always be shared under a MIT License~\cite{mitlicense} in a public Git repository.\footnote{The repositories will always be somewhere on these lists: \href{https://github.com/umbralcalc?tab=repositories}{https://github.com/umbralcalc?tab=repositories}, \href{https://github.com/orgs/worldsoop/repositories}{https://github.com/orgs/worldsoop/repositories}.} Forking these repositories and submitting pull requests for new features or applications is strongly encouraged too, though we apologise in advance if we don't follow these up very quickly as all of this work has to be conducted independently in free time, outside of work hours.

The book is split into two main parts: {\bfseries\sffamily Part 1}, which details the theoretical background and design of code; and {\bfseries\sffamily Part 2}, which explores all of the applications to realistic examples that we wanted to initially try. We hope you, the reader, really enjoy reading through this book and using the all of the code that was built while writing it. We're very grateful to have been able to make use of all the amazing open source software which would otherwise have made this project impossible to achieve.

To cite this book in any work, please use the following BibTeX:
%%
\begin{adjustwidth}{5em}{5em}
\begin{lstlisting}[language=BibTeX,numbers=none]
@article{worlds-of-observation-2023,
  title   = {Worlds Of Observation: Building more realistic environments for machine learning},
  author  = {Hardwick, Robert J. and Gomez-Perales, C. M.},
  journal = {umbralcalc.github.io},
  year    = {2023},
  url     = {https://umbralcalc.github.io/worlds-of-observation/book.pdf},
}
\end{lstlisting}
\end{adjustwidth}
%%

\newpage \ \newpage
{\sffamily \tableofcontents}
\mainmatter

\part*{{\sffamily Part 1}}

\input{building_a_generalised_simulator/chapter.tex}

\input{numerical_time_evolution_of_probabilities/chapter.tex}

\input{empirical_probabilistic_reweighting_algorithms/chapter.tex}

\input{generalised_simulation_inference/chapter.tex}

\input{optimising_interactions_with_any_system/chapter.tex}

\part*{{\sffamily Part 2}}

\input{controlling_parasitic_infections/chapter.tex}

\input{algo_trading_on_financial_markets/chapter.tex}

\input{sustainable_angling_for_fish/chapter.tex}

\input{managing_a_rugby_match/chapter.tex}

\input{optimising_relief_chain_logistics/chapter.tex}


%\appendix
%\chapter{First and only appendix}
\backmatter
\bibliographystyle{JHEP}
\bibliography{book}
\end{document}